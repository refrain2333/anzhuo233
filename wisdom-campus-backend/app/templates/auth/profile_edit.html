<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>编辑个人资料 - 智慧校园学习助手系统</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
</head>
<body>
    <div class="container py-5">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <!-- 导航栏 -->
                <nav class="navbar navbar-expand-lg navbar-light bg-light mb-4 rounded shadow-sm">
                    <div class="container-fluid">
                        <a class="navbar-brand" href="/">智慧校园学习助手</a>
                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarNav">
                            <ul class="navbar-nav me-auto">
                                <li class="nav-item">
                                    <a class="nav-link" href="/api/v1/auth/"><i class="bi bi-house"></i> 首页</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="/api/v1/auth/profile"><i class="bi bi-person-circle"></i> 个人中心</a>
                                </li>
                            </ul>
                            <div class="d-flex">
                                <a href="/api/v1/auth/logout" class="btn btn-outline-secondary btn-sm">
                                    <i class="bi bi-box-arrow-right"></i> 退出登录
                                </a>
                            </div>
                        </div>
                    </div>
                </nav>

                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }}">{{ message }}</div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="bi bi-pencil-square"></i> 编辑个人资料</h5>
                    </div>
                    <div class="card-body">
                        <form method="POST" action="/api/v1/auth/profile/update">
                            <!-- 基本信息部分 -->
                            <h5 class="border-bottom pb-2 mb-3">基本信息</h5>
                            <div class="row mb-4">
                                <!-- 头像 -->
                                <div class="col-md-3 text-center">
                                    <img src="{{ user.avatar_url }}" alt="头像" class="rounded-circle img-thumbnail mb-2" style="width: 100px; height: 100px; object-fit: cover;">
                                    <div class="mt-2">
                                        <input type="file" class="form-control form-control-sm" id="avatar_upload" disabled>
                                        <small class="text-muted">头像功能即将上线</small>
                                    </div>
                                </div>
                                
                                <!-- 基本信息输入 -->
                                <div class="col-md-9">
                                    <div class="mb-3">
                                        <label for="student_id" class="form-label">学号 <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="student_id" name="student_id" value="{{ user.student_id }}" required>
                                        <div class="form-text">请输入您的学号，格式为数字，不少于5位</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="name" class="form-label">姓名 <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="name" name="name" value="{{ user.name }}" required>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="bio" class="form-label">个人简介</label>
                                        <textarea class="form-control" id="bio" name="bio" rows="3">{{ user.bio }}</textarea>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="major_id" class="form-label">所属专业</label>
                                        <select class="form-select" id="major_id" name="major_id">
                                            <option value="">-- 请选择专业 --</option>
                                            <option value="1" {% if user.major_id == 1 %}selected{% endif %}>计算机科学与技术</option>
                                            <option value="2" {% if user.major_id == 2 %}selected{% endif %}>软件工程</option>
                                            <option value="3" {% if user.major_id == 3 %}selected{% endif %}>人工智能</option>
                                            <option value="4" {% if user.major_id == 4 %}selected{% endif %}>网络工程</option>
                                            <option value="5" {% if user.major_id == 5 %}selected{% endif %}>数据科学与大数据技术</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 学习偏好部分 -->
                            <h5 class="border-bottom pb-2 mb-3">学习偏好</h5>
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="learning_style" class="form-label">学习风格</label>
                                        <select class="form-select" id="learning_style" name="learning_style">
                                            <option value="">-- 请选择学习风格 --</option>
                                            <option value="visual" {% if user.profile and user.profile.learning_style == 'visual' %}selected{% endif %}>视觉型</option>
                                            <option value="auditory" {% if user.profile and user.profile.learning_style == 'auditory' %}selected{% endif %}>听觉型</option>
                                            <option value="kinesthetic" {% if user.profile and user.profile.learning_style == 'kinesthetic' %}selected{% endif %}>动手型</option>
                                            <option value="mixed" {% if user.profile and user.profile.learning_style == 'mixed' %}selected{% endif %}>混合型</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="preferred_time" class="form-label">偏好学习时间</label>
                                        <select class="form-select" id="preferred_time" name="preferred_time">
                                            <option value="">-- 请选择偏好时间 --</option>
                                            <option value="morning" {% if user.profile and user.profile.preferred_time == 'morning' %}selected{% endif %}>清晨</option>
                                            <option value="afternoon" {% if user.profile and user.profile.preferred_time == 'afternoon' %}selected{% endif %}>下午</option>
                                            <option value="evening" {% if user.profile and user.profile.preferred_time == 'evening' %}selected{% endif %}>傍晚</option>
                                            <option value="night" {% if user.profile and user.profile.preferred_time == 'night' %}selected{% endif %}>夜晚</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="strengths" class="form-label">学习优势</label>
                                        <textarea class="form-control" id="strengths" name="strengths" rows="3">{% if user.profile %}{{ user.profile.strengths }}{% endif %}</textarea>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="weaknesses" class="form-label">学习弱点</label>
                                        <textarea class="form-control" id="weaknesses" name="weaknesses" rows="3">{% if user.profile %}{{ user.profile.weaknesses }}{% endif %}</textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label for="study_habits" class="form-label">学习习惯</label>
                                <textarea class="form-control" id="study_habits" name="study_habits" rows="3">{% if user.profile %}{{ user.profile.study_habits }}{% endif %}</textarea>
                            </div>
                            
                            <!-- 通知设置部分 -->
                            <h5 class="border-bottom pb-2 mb-3">通知设置</h5>
                            <div class="mb-3 form-check">
                                <input type="checkbox" class="form-check-input" id="notification_email_enabled" name="notification_email_enabled" {% if user.profile and user.profile.notification_email_enabled %}checked{% endif %}>
                                <label class="form-check-label" for="notification_email_enabled">接收邮件通知</label>
                            </div>
                            
                            <div class="mb-4 form-check">
                                <input type="checkbox" class="form-check-input" id="notification_app_enabled" name="notification_app_enabled" {% if user.profile and user.profile.notification_app_enabled %}checked{% endif %}>
                                <label class="form-check-label" for="notification_app_enabled">接收应用内通知</label>
                            </div>
                            
                            <!-- 提交按钮 -->
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <a href="/api/v1/auth/profile" class="btn btn-secondary me-md-2">
                                    <i class="bi bi-x-circle"></i> 取消
                                </a>
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-check-circle"></i> 保存更改
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 表单验证脚本
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('form');
            form.addEventListener('submit', function(event) {
                const studentId = document.getElementById('student_id').value;
                
                // 验证学号格式
                if (!/^\d{5,}$/.test(studentId)) {
                    event.preventDefault();
                    alert('学号必须是至少5位的数字');
                    return false;
                }
                
                return true;
            });
        });
    </script>
</body>
</html> 