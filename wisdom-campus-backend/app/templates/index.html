{% extends "base.html" %}

{% block title %}首页 - 智慧校园学习助手系统{% endblock %}

{% block content %}
<section class="welcome">
    <h2>欢迎使用智慧校园学习助手系统</h2>
    <p>本系统主要用于后端API测试，前端页面仅作为API功能验证使用。</p>
</section>

<section class="api-list">
    <h3>可用API端点</h3>
    <div class="api-card">
        <h4>用户认证</h4>
        <ul>
            <li><code>/api/v1/auth/login</code> - 用户登录</li>
            <li><code>/api/v1/auth/register</code> - 用户注册</li>
            <li><code>/api/v1/auth/logout</code> - 用户登出</li>
        </ul>
    </div>
    
    <div class="api-card">
        <h4>用户管理</h4>
        <ul>
            <li><code>/api/v1/user/profile</code> - 用户资料</li>
            <li><code>/api/v1/user/update</code> - 更新资料</li>
        </ul>
    </div>
    
    <div class="api-card">
        <h4>学习模块</h4>
        <ul>
            <li><code>/api/v1/learning/courses</code> - 课程列表</li>
            <li><code>/api/v1/learning/resources</code> - 学习资源</li>
        </ul>
    </div>
</section>

<section class="api-test">
    <h3>API测试面板</h3>
    <div class="test-container">
        <div class="form-group">
            <label for="api-endpoint">API端点</label>
            <input type="text" id="api-endpoint" placeholder="例如: /api/v1/auth/login">
        </div>
        <div class="form-group">
            <label for="api-method">请求方法</label>
            <select id="api-method">
                <option value="GET">GET</option>
                <option value="POST">POST</option>
                <option value="PUT">PUT</option>
                <option value="DELETE">DELETE</option>
            </select>
        </div>
        <div class="form-group">
            <label for="api-data">请求数据 (JSON)</label>
            <textarea id="api-data" rows="5" placeholder='{"username": "test", "password": "password"}'></textarea>
        </div>
        <button id="send-request" class="btn">发送请求</button>
        <div class="response-container">
            <h4>响应结果</h4>
            <pre id="api-response">请先发送请求...</pre>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const sendBtn = document.getElementById('send-request');
        const endpointInput = document.getElementById('api-endpoint');
        const methodSelect = document.getElementById('api-method');
        const dataTextarea = document.getElementById('api-data');
        const responseArea = document.getElementById('api-response');
        
        sendBtn.addEventListener('click', async function() {
            const endpoint = endpointInput.value.trim();
            const method = methodSelect.value;
            let data = null;
            
            try {
                data = dataTextarea.value ? JSON.parse(dataTextarea.value) : null;
            } catch (e) {
                responseArea.textContent = '请求数据JSON格式错误: ' + e.message;
                return;
            }
            
            if (!endpoint) {
                responseArea.textContent = '请输入API端点!';
                return;
            }
            
            responseArea.textContent = '请求中...';
            
            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                };
                
                if (data && (method === 'POST' || method === 'PUT')) {
                    options.body = JSON.stringify(data);
                }
                
                const response = await fetch(endpoint, options);
                const result = await response.json();
                
                responseArea.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                responseArea.textContent = '请求错误: ' + error.message;
            }
        });
    });
</script>
{% endblock %} 